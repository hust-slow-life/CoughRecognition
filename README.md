# CoughRecognition 咳嗽识别

一款面向家长的 iOS 医疗辅助决策工具，通过 AI 分析孩子的咳嗽声音，帮助家长记录病程、辅助就医决策。

## 产品概述

### 解决什么问题
- 孩子咳嗽时，家长难以准确描述咳嗽类型（干咳/湿咳等）
- 就医时孩子可能不咳嗽，医生无法直接听到
- 夜间孩子咳嗽，家长可能睡着听不到
- 病程记录零散，难以追踪变化趋势

### 核心功能
1. **一键录制**：孩子咳嗽时快速录下来
2. **AI 分析**：识别咳嗽类型（干咳、湿咳、犬吠样咳等）
3. **后台监控**：夜间自动检测并录制咳嗽/哭泣
4. **诊疗建议**：结合咳嗽分析提供初步建议（仅供参考）
5. **分享给医生**：就诊时播放录音给医生听

### 目标用户
- 有未成年孩子的家庭（父母、祖父母、保姆）
- 使用时机：孩子生病时（3天-2周周期）

## 项目文档

| 文档 | 说明 | 状态 |
|------|------|------|
| [PRD.md](PRD.md) | 产品需求文档，功能详细定义 | ✅ 完成 |
| [需求讨论.md](需求讨论.md) | 需求讨论记录和场景分析 | ✅ 完成 |
| [需求澄清记录.md](需求澄清记录.md) | 42 个需求问题的澄清答案 | ✅ 完成 |
| [设计方案.md](设计方案.md) | 技术方案设计（概要） | ✅ 完成 |
| [Docs/API-Spec.md](Docs/API-Spec.md) | 云端 API 接口规格文档 | ✅ 完成 |
| [Docs/ML-Plan.md](Docs/ML-Plan.md) | ML 方案详细文档 | ✅ 完成 |
| [Docs/Server-Design.md](Docs/Server-Design.md) | 服务端详细设计文档 | ✅ 完成 |
| [prototype/](prototype/) | 网页版交互原型 | ✅ 完成 |

## 交互原型

打开 `prototype/index.html` 可查看交互原型，包含：
- 录制页（含监控模式切换）
- 历史记录页
- 分析详情页
- 设置页

## 技术栈（规划）

### iOS 客户端

| 模块 | 技术选型 |
|------|----------|
| 平台 | iOS 17.0+ |
| UI | SwiftUI |
| 音频处理 | AVFoundation |
| ML 推理 | Core ML (咳嗽/哭泣检测) |
| 本地存储 | SwiftData |
| 网络请求 | URLSession |

### 服务端

| 模块 | 技术选型 |
|------|----------|
| API 网关 | Node.js 20 + Fastify + TypeScript |
| ML 服务 | Python + FastAPI |
| 数据库 | PostgreSQL 16 |
| 缓存 | Redis 7 |
| 对象存储 | S3 兼容 (MinIO / AWS S3) |
| LLM | OpenAI / Claude API |

详见 [Docs/Server-Design.md](Docs/Server-Design.md)

---

## 开发待办事项

### Phase 1：项目基础
- [ ] 创建 Xcode 项目，配置基础架构
- [ ] 搭建 SwiftUI 页面框架（录制页、历史页、分析页、设置页）
- [ ] 实现 Tab 导航和页面路由
- [ ] 设计并实现本地数据模型（SwiftData）

### Phase 2：录音功能
- [ ] 实现麦克风权限请求
- [ ] 实现一键录制功能（AVAudioRecorder）
- [ ] 录制界面 UI（计时器、停止按钮）
- [ ] 录音文件本地存储和管理
- [ ] 录音播放功能（AVAudioPlayer）
- [ ] 录音分享功能（UIActivityViewController）

### Phase 3：后台监控
- [ ] 实现后台音频录制权限配置
- [ ] 持续音频监听（熄屏运行）
- [ ] 咳嗽/哭泣检测触发逻辑
- [ ] 自动录制片段（检测点前后各 5 秒）
- [ ] 静默段自动裁剪
- [ ] 监控状态管理和 UI 反馈

### Phase 4：咳嗽分析
- [x] 调研咳嗽检测模型方案（YAMNet / 自训练）→ 见 [Docs/ML-Plan.md](Docs/ML-Plan.md)
- [x] 调研咳嗽分类数据集（COUGHVID 等）→ 见 [Docs/ML-Plan.md](Docs/ML-Plan.md)
- [x] 设计云端分析 API 接口 → 见 [Docs/API-Spec.md](Docs/API-Spec.md)
- [ ] 实现录音上传和分析结果获取
- [ ] 支持离线录制、联网后分析
- [ ] 多次咳嗽分别识别逻辑
- [ ] 年龄段参数传递（影响模型选择）

### Phase 5：分析结果展示
- [ ] 分析详情页 UI
- [ ] 咳嗽类型展示（干咳/湿咳/犬吠样咳等）
- [ ] 每次咳嗽的时间点和置信度
- [ ] 波形可视化（可选）

### Phase 6：AI 诊疗建议
- [x] 设计 AI 诊疗建议生成逻辑 → 见 [Docs/API-Spec.md](Docs/API-Spec.md)
- [ ] 接入 LLM API（GPT/Claude 等）
- [x] 组装 prompt（咳嗽类型 + 年龄 + 病程信息）→ 见 [Docs/API-Spec.md](Docs/API-Spec.md)
- [ ] 建议结果展示 UI
- [ ] 免责声明展示

### Phase 7：历史记录
- [ ] 历史记录列表页（按天分组）
- [ ] 录音条目展示（时间、类型、来源）
- [ ] 点击进入分析详情
- [ ] 删除录音功能
- [ ] 简单统计报告（咳嗽次数、频率）

### Phase 8：设置和其他
- [ ] 孩子年龄段设置（选择器）
- [ ] 默认年龄段持久化
- [ ] 健康日志入口（P1，可后续做）
- [ ] 关于页面
- [ ] 免责声明页面
- [ ] App 图标和启动页

### Phase 9：服务端开发
- [x] 服务端技术栈选型 → 见 [Docs/Server-Design.md](Docs/Server-Design.md)
- [x] 用户系统设计（注册/登录/设备绑定/孩子档案）
- [x] 隐私与存储方案设计
- [x] 部署方案设计（Docker / K8s / 直接启动）
- [ ] 创建 Node.js 项目，搭建 Fastify 框架
- [ ] 实现用户认证模块（JWT）
- [ ] 实现孩子档案 CRUD
- [ ] 搭建 Python ML 微服务
- [ ] 实现咳嗽分析 API
- [ ] 实现 AI 诊疗建议 API
- [ ] 部署到测试环境

### Phase 10：测试和优化
- [ ] 录音质量测试（不同距离、环境噪音）
- [ ] 后台监控耗电测试
- [ ] 分析准确率评估
- [ ] UI/UX 优化
- [ ] 性能优化

---

## 关键技术点

### 后台音频监控
需要配置 `Info.plist`：
```xml
<key>UIBackgroundModes</key>
<array>
    <string>audio</string>
</array>
```

### 咳嗽检测方案
推荐：YAMNet + 迁移学习
- 在 COUGHVID 数据集上 Fine-tune
- 转换为 Core ML 格式
- 预计模型大小 10-20MB

### 年龄段适配
不同年龄段咳嗽声音特征差异大：
- 婴儿 (0-1岁)
- 幼儿 (1-3岁)
- 学龄前 (3-6岁)
- 学龄 (6-18岁)

需要针对年龄段优化模型或调整参数。

---

## 注意事项

1. **医疗免责**：产品定位为"辅助记录"，不是"医疗诊断"，必须有免责声明
2. **隐私保护**：已设计隐私方案（见 Server-Design.md），包括：
   - 音频文件默认不保留（分析后删除）
   - 敏感字段加密存储
   - GDPR 合规（数据导出、账户删除）
3. **儿童数据**：现有公开数据集以成人为主，儿童咳嗽数据较少，需通过用户反馈持续优化

---

## 联系方式

如有问题，请联系项目负责人。
